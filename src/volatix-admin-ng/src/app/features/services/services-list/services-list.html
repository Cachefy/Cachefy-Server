<div class="grid">
  <section>
    <div class="card">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
        <h2 class="text-app">Registered services</h2>
        <button class="btn primary btn-ripple" (click)="openCreateForm()">
          <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
          </svg>
          Add Service
        </button>
      </div>

      <table class="min-w-full table-fixed text-sm">
        <thead>
          <tr class="text-left text-xs text-slate-400 border-b border-slate-800">
            <th class="p-2 w-64">Service</th>
            <th class="p-2 w-24">Status</th>
            <th class="p-2 w-24">Instances</th>
            <th class="p-2 w-48">Last seen</th>
            <th class="p-2 col-actions">Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (service of paginatedServices; track service.id || service.name) {
          <tr>
            <td class="p-2">{{ service.name }}</td>
            <td class="p-2" style="text-transform: capitalize">
              {{ service.status || 'â€”' }}
              @switch ((service.status || 'unknown').toLowerCase()) { @case ('healthy') {
              <span style="color: #10b981; font-size: 12px; margin-left: 6px">âœ“</span>
              } @case ('degraded') {
              <span style="color: #f59e0b; font-size: 12px; margin-left: 6px">âš </span>
              } @case ('down') {
              <span style="color: #ef4444; font-size: 12px; margin-left: 6px">âœ—</span>
              } @case ('maintenance') {
              <span style="color: #6b7280; font-size: 12px; margin-left: 6px">ðŸ”§</span>
              } @default {
              <span style="color: #6b7280; font-size: 12px; margin-left: 6px">?</span>
              } }
            </td>
            <td class="p-2">{{ service.instances || 'â€”' }}</td>
            <td class="p-2">{{ service.lastSeen || 'Unknown' }}</td>
            <td class="p-2 col-actions">
              <div class="table-actions">
                <button class="btn primary sm btn-ripple" (click)="viewServiceDetails(service)">
                  <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                  Details
                </button>
                <button class="btn secondary sm btn-ripple" (click)="openEditForm(service)">
                  <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                  </svg>
                  Edit
                </button>
                <button class="btn danger sm btn-ripple" (click)="deleteService(service)">
                  <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                  </svg>
                  Delete
                </button>
              </div>
            </td>
          </tr>
          } @empty {
          <tr>
            <td class="p-2 text-slate-400" colspan="5">No services found.</td>
          </tr>
          }
        </tbody>
      </table>

      <app-pagination
        [currentPage]="currentPage()"
        [totalPages]="totalPages"
        [pageInfo]="'Page ' + currentPage() + ' of ' + totalPages"
        (pageChange)="onPageChange($event)"
        (prevClick)="onPageChange(currentPage() - 1)"
        (nextClick)="onPageChange(currentPage() + 1)"
      >
      </app-pagination>
    </div>
  </section>

  <aside>
    <div class="card">
      <h2>Notes</h2>
      <div style="font-size: 12px">
        Services register caches and policies at startup. Keep clients up to date.
      </div>
    </div>
  </aside>
</div>

<!-- Service Form Modal -->
<app-modal 
  [isOpen]="showServiceForm()" 
  [title]="isEditing ? 'Edit Service' : 'Create New Service'"
  [closeOnBackdrop]="false"
  (closeModal)="closeForm()">
  
  <form (ngSubmit)="saveService()">
    <div class="form-group">
      <label for="serviceName">Service Name *</label>
      <input
        id="serviceName"
        type="text"
        [(ngModel)]="serviceForm.name"
        name="serviceName"
        placeholder="Enter service name"
        required
        class="form-input"
      />
    </div>

    <div class="form-group">
      <label for="serviceUrl">Service URL</label>
      <input
        id="serviceUrl"
        type="url"
        [(ngModel)]="serviceForm.url"
        name="serviceUrl"
        placeholder="https://service.example.com"
        class="form-input"
      />
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="serviceStatus">Status</label>
        <select
          id="serviceStatus"
          [(ngModel)]="serviceForm.status"
          name="serviceStatus"
          class="form-input"
        >
          <option value="Healthy">Healthy</option>
          <option value="Degraded">Degraded</option>
          <option value="Down">Down</option>
          <option value="Maintenance">Maintenance</option>
        </select>
      </div>

      <div class="form-group">
        <label for="serviceInstances">Instances</label>
        <input
          id="serviceInstances"
          type="number"
          [(ngModel)]="serviceForm.instances"
          name="serviceInstances"
          min="0"
          placeholder="1"
          class="form-input"
        />
      </div>
    </div>

    <div class="form-group">
      <label for="serviceVersion">Version</label>
      <input
        id="serviceVersion"
        type="text"
        [(ngModel)]="serviceForm.version"
        name="serviceVersion"
        placeholder="1.0.0"
        class="form-input"
      />
    </div>

    <div class="form-group">
      <label for="serviceDescription">Description</label>
      <textarea
        id="serviceDescription"
        [(ngModel)]="serviceForm.description"
        name="serviceDescription"
        rows="3"
        placeholder="Enter service description"
        class="form-input"
      ></textarea>
    </div>

    <div class="modal-actions">
      <button type="button" class="btn secondary btn-ripple" (click)="closeForm()">
        Cancel
      </button>
      <button type="submit" class="btn primary btn-ripple">
        {{ isEditing ? 'Update Service' : 'Create Service' }}
      </button>
    </div>
  </form>
  
</app-modal>

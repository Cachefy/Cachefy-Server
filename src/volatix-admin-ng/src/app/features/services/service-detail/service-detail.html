<div id="page-service" class="page">
  <div class="grid">
    <section>
      <div class="card">
        <div class="row" style="align-items: center; justify-content: space-between">
          <div class="text-app" style="font-weight: 700">Service details</div>
          <button class="btn secondary btn-ripple" (click)="goBack()">
            <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M15 19l-7-7 7-7"
              />
            </svg>
            Back to Services
          </button>
        </div>
        <div
          class="kv"
          style="display: grid; grid-template-columns: 180px 1fr; gap: 8px; margin-top: 12px"
        >
          @for (detail of getServiceDetails(); track detail.label) {
          <div class="text-slate-400">{{ detail.label }}:</div>
          <div
            class="text"
            [class]="detail.label === 'Status' ? getStatusClass(detail.value) : ''"
            style="display: flex; align-items: center; gap: 8px"
          >
            {{ detail.value }}
            @if (detail.label === 'Status') { @switch (detail.value?.toLowerCase()) { @case
            ('healthy') {
            <span style="color: #10b981">âœ“</span>
            } @case ('degraded') {
            <span style="color: #f59e0b">âš </span>
            } @case ('down') {
            <span style="color: #ef4444">âœ—</span>
            } @case ('maintenance') {
            <span style="color: #6b7280">ðŸ”§</span>
            } @default {
            <span style="color: #6b7280">?</span>
            } } }
          </div>
          }
        </div>
      </div>

      <div class="card" style="margin-top: 16px">
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
          "
        >
          <h2 class="text-app">Caches for this service</h2>
          @if (caches().length > 0) {
          <button
            class="btn danger sm btn-ripple"
            (click)="flushAllCaches()"
            [disabled]="isFlushingCaches()"
          >
            <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
              />
            </svg>
            {{ isFlushingCaches() ? 'Flushing...' : 'Flush All Caches' }}
          </button>
          }
        </div>
        @if (paginatedCaches().length > 0) {
        <table class="min-w-full table-fixed text-sm">
          <thead>
            <tr class="text-left text-xs text-slate-400 border-b border-slate-800">
              <th class="p-2">Cache Name</th>
              <th class="p-2 col-actions">Actions</th>
            </tr>
          </thead>
          <tbody>
            @for (cacheName of paginatedCaches(); track cacheName) {
            <tr class="border-b border-slate-800 hover:bg-slate-800/50">
              <td class="p-2">{{ cacheName }}</td>
              <td class="p-2 col-actions">
                <button
                  class="btn danger sm btn-ripple"
                  (click)="removeCacheByKey(cacheName)"
                  [disabled]="removingCache() === cacheName"
                >
                  <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                    />
                  </svg>
                  {{ removingCache() === cacheName ? 'Removing...' : 'Remove' }}
                </button>
              </td>
            </tr>
            }
          </tbody>
        </table>

        @if (totalPages() > 1) {
        <app-pagination
          [currentPage]="currentPage()"
          [totalPages]="totalPages()"
          (pageChange)="onPageChange($event)"
        ></app-pagination>
        } } @else {
        <div class="text-center text-slate-400 py-8">No caches found for this service</div>
        }
      </div>
    </section>

    <aside>
      <div class="card">
        <h2 class="text-app">Service snapshot (JSON)</h2>
        <div style="font-size: 12px; margin-bottom: 6px">
          Includes serviceId, service info, and all caches for this service.
        </div>
        <pre
          class="pre"
          style="
            font-family: monospace;
            font-size: 12px;
            min-height: 100px;
            color: var(--muted);
            background: rgba(255, 255, 255, 0.04);
            padding: 10px;
            border-radius: 8px;
          "
          >{{ serviceSnapshot() | json }}</pre
        >
        <div class="row" style="margin-top: 8px">
          <button class="btn primary sm btn-ripple" (click)="copyJSON()">
            <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"
              />
            </svg>
            Copy JSON
          </button>
          <button class="btn secondary sm btn-ripple" (click)="downloadJSON()">
            <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
              />
            </svg>
            Download JSON
          </button>
        </div>
      </div>
    </aside>
  </div>
</div>
